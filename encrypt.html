<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AES-256 νμΌ μ•”νΈν™” λ„κµ¬</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    textarea, input, button { width: 100%; padding: 10px; margin: 10px 0; font-family: monospace; }
    .output { background: #f4f4f4; padding: 10px; white-space: pre-wrap; border: 1px solid #ccc; cursor: pointer; }
    .output:hover { background: #e8f0fe; }
    .warning { color: red; font-weight: bold; }
  </style>
</head>
<body>

  <h2>π” AES-256 μ•”λ³µνΈν™” λ„κµ¬ (μλ™ IV)</h2>

  <button onclick="resetFields()">π”„ μ΄κΈ°ν™”</button>

  <label>π“‚ μ €μ¥λ ν‚¤ μ„ νƒ</label>
  <select id="savedKeys" onchange="loadSavedKey()">
    <option value="">-- μ €μ¥λ ν‚¤ μ—†μ --</option>
  </select>
  <button onclick="deleteSelectedKey()">μ„ νƒ ν‚¤ μ‚­μ </button>


  <label>μ•”νΈν™” λ¨λ“ μ„ νƒ</label>
  <select id="modeSelect">
    <option value="CBC">CBC</option>
    <option value="ECB">ECB</option>
    <option value="CTR">CTR</option>
    <option value="GCM">GCM</option>
  </select>
  
  <label>π”‘ ν‚¤ μ‚¬μ΄μ¦ μ„ νƒ</label>
  <select id="keySizeSelect" onchange="adjustKeyLength()">
    <option value="256" selected>256λΉ„νΈ (32μλ¦¬)</option>
    <option value="192">192λΉ„νΈ (24μλ¦¬)</option>
    <option value="128">128λΉ„νΈ (16μλ¦¬)</option>
  </select>

  <label>π”‘ μ•”νΈ ν‚¤ (32μλ¦¬)</label>
  <input type="text" id="key" maxlength="32" placeholder="μ„ νƒν• ν‚¤ μ‚¬μ΄μ¦μ— λ§κ² μ…λ ¥" oninput="validateKey()">
  <div id="keyWarning" class="warning"></div>

  <label>π” IV (μ• 16μλ¦¬)</label>
  <input type="text" id="iv" maxlength="16" placeholder="μ: 16μλ¦¬ ν‚¤ μ…λ ¥">

  <label>π“ ν‰λ¬Έ μ…λ ¥</label>
  <textarea id="plainText" placeholder="μ•”νΈν™”ν•  ν…μ¤νΈ μ…λ ¥"></textarea>
  <button onclick="encrypt()">μ•”νΈν™”</button>

  <label>π”’ μ•”νΈλ¬Έ μ…λ ¥</label>
  <textarea id="cipherText" placeholder="λ³µνΈν™”ν•  μ•”νΈλ¬Έ μ…λ ¥"></textarea>
  <button onclick="decrypt()">λ³µνΈν™”</button>

  <label>π“ νμΌ μ„ νƒ (.txt)</label>
  <input type="file" id="fileInput" accept=".txt">
  <button onclick="encryptFile()">νμΌ μ•”νΈν™”</button>
  <button onclick="decryptFile()">νμΌ λ³µνΈν™”</button>

  <h3>π“¦ κ²°κ³Ό (ν΄λ¦­ μ‹ λ³µμ‚¬λ¨)</h3>
  <div class="output" id="resultBox" onclick="copyResult()">κ²°κ³Όκ°€ μ—¬κΈ°μ— ν‘μ‹λ©λ‹λ‹¤...</div>

  <script>

    function getRequiredKeyLength() {
      const size = parseInt(document.getElementById("keySizeSelect").value);
      return size / 8;
    }

    function adjustKeyLength() {
      const keyInput = document.getElementById("key");
      keyInput.value = "";
      validateKey();
    }

    function validateKey() {
      updateIV();
      const key = document.getElementById("key").value;
      const requiredLength = getRequiredKeyLength();
      const warning = document.getElementById("keyWarning");
      
      if (key.length > requiredLength) {
        document.getElementById("key").value = key.substring(0, requiredLength);
      }
      warning.innerText = key.length !== requiredLength ? `β— ν‚¤λ” μ •ν™•ν ${requiredLength}μλ¦¬μ—¬μ•Ό ν•©λ‹λ‹¤.` : "";
    }

    function generateIV() {
      const key = document.getElementById("key").value;
      // const iv = CryptoJS.lib.WordArray.random(16).toString(CryptoJS.enc.Hex).substring(0, 16);
      const iv = 
      document.getElementById("iv").value = iv;
    }

    function resetFields() {
      document.getElementById("key").value = "";
      document.getElementById("iv").value = "";
      document.getElementById("plainText").value = "";
      document.getElementById("cipherText").value = "";
      document.getElementById("resultBox").innerText = "κ²°κ³Όκ°€ μ—¬κΈ°μ— ν‘μ‹λ©λ‹λ‹¤...";
      document.getElementById("keyWarning").innerText = "";
    }


    function updateIV() {
      const key = document.getElementById("key").value;
      const ivField = document.getElementById("iv");
      const warning = document.getElementById("keyWarning");

      
      if(ivField.value.length===0){    
        if (key.length < 32) {
        } else {
          warning.innerText = "";
          ivField.value = key.substring(0, 16);
        }
      }
    }
    
  function encrypt() {
      const mode = document.getElementById("modeSelect").value;
      const key = document.getElementById("key").value;
      const iv = document.getElementById("iv").value;
      const text = document.getElementById("plainText").value;
      const requiredLength = getRequiredKeyLength();

      if (key.length !== requiredLength) return alert(`ν‚¤λ” ${requiredLength}μλ¦¬μ—¬μ•Ό ν•©λ‹λ‹¤.`);
      if (!text) return alert("μ•”νΈν™”ν•  ν…μ¤νΈλ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”.");
      
      const keyWA = CryptoJS.enc.Utf8.parse(key);
      const ivWA = CryptoJS.enc.Utf8.parse(iv);

      let encrypted;
      try {
        switch (mode) {
          case "ECB":
            encrypted = CryptoJS.AES.encrypt(text, keyWA, {
              mode: CryptoJS.mode.ECB,
              padding: CryptoJS.pad.Pkcs7
            });
            break;
          case "CBC":
            encrypted = CryptoJS.AES.encrypt(text, keyWA, {
              iv: ivWA,
              mode: CryptoJS.mode.CBC,
              padding: CryptoJS.pad.Pkcs7
            });
            break;
          case "CTR":
            encrypted = CryptoJS.AES.encrypt(text, keyWA, {
              iv: ivWA,
              mode: CryptoJS.mode.CTR,
              padding: CryptoJS.pad.Pkcs7
            });
            break;
          case "GCM":
            alert("β οΈ ν„μ¬ GCM λ¨λ“λ¥Ό κΈ°λ³Έ μ§€μ›ν•μ§€ μ•μµλ‹λ‹¤. CTR λλ” CBCλ¥Ό μ‚¬μ©ν•΄μ£Όμ„Έμ”.");
            return;
        }
        document.getElementById("resultBox").innerText = encrypted.toString();
        document.getElementById("cipherText").value = encrypted.toString();
      } catch (e) {
        alert("β μ•”νΈν™” μ‹¤ν¨: μ…λ ¥κ°’μ„ ν™•μΈν•΄μ£Όμ„Έμ”.");
      }

    }

    function decrypt() {
      const mode = document.getElementById("modeSelect").value;
      const key = document.getElementById("key").value;
      const iv = document.getElementById("iv").value;
      const cipher = document.getElementById("cipherText").value;
      const requiredLength = getRequiredKeyLength();

      if (key.length !== requiredLength) return alert(`ν‚¤λ” ${requiredLength}μλ¦¬μ—¬μ•Ό ν•©λ‹λ‹¤.`);
      if (!cipher) return alert("λ³µνΈν™”ν•  μ•”νΈλ¬Έμ„ μ…λ ¥ν•΄μ£Όμ„Έμ”.");

      const keyWA = CryptoJS.enc.Utf8.parse(key);
      const ivWA = CryptoJS.enc.Utf8.parse(iv);

      try {
        let decrypted;
        switch (mode) {
          case "ECB":
            decrypted = CryptoJS.AES.decrypt(cipher, keyWA, {
              mode: CryptoJS.mode.ECB,
              padding: CryptoJS.pad.Pkcs7
            });
            break;
          case "CBC":
            decrypted = CryptoJS.AES.decrypt(cipher, keyWA, {
              iv: ivWA,
              mode: CryptoJS.mode.CBC,
              padding: CryptoJS.pad.Pkcs7
            });
            break;
          case "CTR":
            decrypted = CryptoJS.AES.decrypt(cipher, keyWA, {
              iv: ivWA,
              mode: CryptoJS.mode.CTR,
              padding: CryptoJS.pad.Pkcs7
            });
            break;
          case "GCM":
            alert("β οΈ ν„μ¬ GCM λ¨λ“λ¥Ό κΈ°λ³Έ μ§€μ›ν•μ§€ μ•μµλ‹λ‹¤. CTR λλ” CBCλ¥Ό μ‚¬μ©ν•΄μ£Όμ„Έμ”.");
            return;
        }
        const plain = decrypted.toString(CryptoJS.enc.Utf8);
        if (!plain) throw new Error("λ³µνΈν™” μ‹¤ν¨");
        document.getElementById("resultBox").innerText = plain;
        document.getElementById("plainText").value = plain;
      } catch (e) {
        alert("β λ³µνΈν™” μ‹¤ν¨: ν‚¤ λλ” μ•”νΈλ¬Έμ„ ν™•μΈν•΄μ£Όμ„Έμ”.");
      }

    }


    function encryptFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("νμΌμ„ μ„ νƒν•΄μ£Όμ„Έμ”.");
      if (!validateKey()) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById("plainText").value = e.target.result;
        encrypt();
      };
      reader.readAsText(file);
    }

    function decryptFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("νμΌμ„ μ„ νƒν•΄μ£Όμ„Έμ”.");
      if (!validateKey()) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById("cipherText").value = e.target.result;
        decrypt();
      };
      reader.readAsText(file);
    }

    function copyResult() {
      const text = document.getElementById("resultBox").innerText;
      if (!text || text.includes("κ²°κ³Όκ°€ μ—¬κΈ°μ—")) return;
      navigator.clipboard.writeText(text).then(() => {
        document.getElementById("resultBox").innerText = "β… λ³µμ‚¬λ¨!\n\n" + text;
        setTimeout(() => {
          document.getElementById("resultBox").innerText = text;
        }, 1500);
      });
    }



    function saveKeyToStorage(key) {
    if (!key) return;
    let keys = JSON.parse(localStorage.getItem("aesKeys") || "[]");
    if (!keys.includes(key)) {
      keys.push(key);
      localStorage.setItem("aesKeys", JSON.stringify(keys));
      updateSavedKeysDropdown();
    }
  }

  function updateSavedKeysDropdown() {
    const select = document.getElementById("savedKeys");
    select.innerHTML = '<option value="">-- μ €μ¥λ ν‚¤ μ—†μ --</option>';
    const keys = JSON.parse(localStorage.getItem("aesKeys") || "[]");
    keys.forEach(k => {
      const option = document.createElement("option");
      option.value = k;
      option.textContent = k;
      select.appendChild(option);
    });
  }

  function loadSavedKey() {
    const selected = document.getElementById("savedKeys").value;
    if (selected) {
      document.getElementById("key").value = selected;
      validateKey();
    }
  }

  function deleteSelectedKey() {
    const selected = document.getElementById("savedKeys").value;
    if (!selected) return;
    let keys = JSON.parse(localStorage.getItem("aesKeys") || "[]");
    keys = keys.filter(k => k !== selected);
    localStorage.setItem("aesKeys", JSON.stringify(keys));
    updateSavedKeysDropdown();
    document.getElementById("key").value = "";
  }

  window.onload = updateSavedKeysDropdown;

  // μ•”νΈν™”/λ³µνΈν™” ν•¨μ λ‚΄λ¶€μ— μ¶”κ°€:
  saveKeyToStorage(key); // ν‚¤ μ €μ¥

  </script>

</body>
</html>