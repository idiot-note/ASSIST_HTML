<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 저장</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            margin-top: 10px;
        }
        #image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        #image-container .img-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s;
        }
        #image-container .img-wrapper:hover {
            transform: scale(1.1); /* 이미지 확대 효과 */
        }
        #image-container img {
            width: 100%;
            max-width: 200px;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }
        #image-container .img-wrapper.transparent {
            background-color: transparent; /* 기본 배경은 투명 */
        }
        #image-container .img-wrapper.white-background {
            background-color: white; /* 배경색을 흰색으로 설정 */
        }
    </style>
</head>
<body>
    <button onclick="window.open('https://e.kakao.com/', '_blank');">카카오 이모티콘샵</button>
    <h1>이미지 추출 및 저장</h1>
    <p>이미지를 클릭하면 파일로 저장됩니다.</p>
    
    <label>
        <input type="checkbox" id="white-background-checkbox"> 하얀 배경 적용
    </label>

    <textarea id="html-input" placeholder="여기에 body element를 코드를 붙여넣으세요"></textarea>
    <button id="extract-images">이미지 추출</button>
    <h2>추출된 이미지:</h2>
    <div id="image-container">여기에 이미지가 표시됩니다...</div>

    <script>
        document.getElementById('extract-images').addEventListener('click', () => {
            const htmlInput = document.getElementById('html-input').value; 
            const imageContainer = document.getElementById('image-container');
            imageContainer.innerHTML = ''; 

            if (!htmlInput) {
                alert('body element를 입력해주세요.');
                return;
            }

            const isWhiteBackground = document.getElementById('white-background-checkbox').checked;

            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlInput, 'text/html');
                const imgTags = doc.querySelectorAll('img');
                if (imgTags.length === 0) {
                    imageContainer.innerHTML = '이미지가 없습니다.';
                    return;
                }

                imgTags.forEach(img => {
                    const imgWrapper = document.createElement('div');
                    imgWrapper.classList.add('img-wrapper');
                    
                    if (isWhiteBackground) {
                        imgWrapper.classList.add('white-background');
                    } else {
                        imgWrapper.classList.add('transparent');
                    }

                    const imgElement = document.createElement('img');
                    imgElement.src = img.src;
                    imgElement.alt = '추출된 이미지';

                    if (img.src.includes("img_send.png") || img.src.includes("thumb_empty.png")) {
                        console.log(`예외 이미지: ${img.src}`);
                        return; 
                    }

                    const downloadLink = document.createElement('a');
                    downloadLink.href = img.src;
                    downloadLink.download = img.src.split('/').pop(); // 이미지 파일명 설정
                    downloadLink.style.display = 'none';

                    imgElement.addEventListener('click', () => {
                        downloadLink.click(); // 이미지를 클릭하면 다운로드
                    });

                    imgWrapper.appendChild(imgElement);
                    imgWrapper.appendChild(downloadLink);
                    imageContainer.appendChild(imgWrapper);
                });
            } catch (error) {
                console.error('오류 발생:', error);
                imageContainer.innerHTML = '오류가 발생했습니다.';
            }
        });
    </script>
</body>
</html>