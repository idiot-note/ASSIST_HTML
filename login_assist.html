<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES-256 API í…ŒìŠ¤í„° (ì €ì¥ ê¸°ëŠ¥ í¬í•¨)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 380px;
        }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        
        /* ì„¤ì • ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .config-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
        }
        .config-box label {
            display: block;
            margin-top: 8px;
            margin-bottom: 4px;
            font-weight: bold;
            color: #555;
        }
        .config-box label:first-child { margin-top: 0; }
        .config-box input, .config-box select {
            margin-bottom: 5px;
            font-family: monospace;
            font-size: 12px;
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 6px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus { border-color: #007bff; outline: none; }
        
        button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #0056b3; }

        /* ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #result-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #e2e6ea;
            border-radius: 6px;
            cursor: pointer;
            display: none;
            text-align: center;
            border: 2px dashed #adb5bd;
            word-break: break-all;
        }
        #result-area:hover { background-color: #d1d7dd; border-color: #6c757d; }
        #result-text { font-size: 18px; font-weight: bold; color: #212529; }
        .tooltip { font-size: 12px; color: #666; margin-top: 8px; }

        /* Toast (Snackbar) ìŠ¤íƒ€ì¼ */
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>AES-256 API í…ŒìŠ¤í„°</h2>

        <div class="config-box">
            <label>ğŸŒ API URL (í†µì‹  ì£¼ì†Œ):</label>
            <input type="text" id="api-url" placeholder="http://ip:port/path">

            <label>ğŸ“¡ HTTP Method:</label>
            <select id="http-method">
                <option value="POST" selected>POST</option>
                <option value="PUT">PUT</option>
                <option value="GET">GET</option>
                <option value="DELETE">DELETE</option>
            </select>

            <label>ğŸ” AES Key (32ì í•„ìˆ˜):</label>
            <input type="text" id="aes-key" maxlength="32" placeholder="32ìë¦¬ í‚¤ ì…ë ¥">
            
            <label>Request Key (ID):</label>
            <input type="text" id="key-id" value="userId">
            
            <label>Request Key (PWD):</label>
            <input type="text" id="key-pwd" value="pwd">

            <label>Response Path:</label>
            <input type="text" id="res-path" value="body.data.LEVEL">
        </div>

        <input type="text" id="input-id" placeholder="ì•„ì´ë”” ì…ë ¥">
        <input type="password" id="input-pwd" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ì•”í˜¸í™”ë˜ì–´ ì „ì†¡ë¨)">
        
        <button id="send-btn" onclick="processRequest()">ì•”í˜¸í™” ë° ì „ì†¡</button>

        <div id="result-area" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">
            <div id="result-text"></div>
            <div class="tooltip">ğŸ“‹ í´ë¦­í•˜ë©´ ê²°ê³¼ê°€ ë³µì‚¬ë©ë‹ˆë‹¤</div>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        // --- [1] ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ ì˜ì—­ ---
        const STORAGE_KEY = 'aesApiTesterConfig_v1';
        
        // ì €ì¥í•  ì…ë ¥ì°½ë“¤ì˜ ID ëª©ë¡ (ë¹„ë°€ë²ˆí˜¸ input-pwdëŠ” ë³´ì•ˆìƒ ì œì™¸)
        const configIds = ['api-url', 'http-method', 'aes-key', 'key-id', 'key-pwd', 'res-path', 'input-id'];

        function saveSettings() {
            const data = {};
            configIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    data[id] = element.value;
                }
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function loadSettings() {
            const savedString = localStorage.getItem(STORAGE_KEY);
            if (savedString) {
                const data = JSON.parse(savedString);
                configIds.forEach(id => {
                    if (data[id] !== undefined) {
                        const element = document.getElementById(id);
                        if (element) element.value = data[id];
                    }
                });
            } else {
                // ì €ì¥ëœ ê°’ì´ ì—†ì„ ë•Œ ê¸°ë³¸ê°’ ì„¤ì • (ì²˜ìŒ ì‹¤í–‰ ì‹œ)
                document.getElementById('api-url').value = "https://api.example.com/login";
                document.getElementById('aes-key').value = "01234567890123456789012345678901";
            }
        }

        // ì…ë ¥ì°½ì— ë³€ê²½ì´ ì¼ì–´ë‚  ë•Œë§ˆë‹¤ ìë™ ì €ì¥ ì´ë²¤íŠ¸ ì—°ê²°
        configIds.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', saveSettings);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', loadSettings);


        // --- [2] ê¸°ì¡´ ë¡œì§ ë° ì•”í˜¸í™” ì˜ì—­ ---
        
        // ì—”í„°í‚¤ ê°ì§€ ì„¤ì •
        document.getElementById("input-id").addEventListener("keypress", function(event) {
            if (event.key === "Enter") processRequest();
        });
        document.getElementById("input-pwd").addEventListener("keypress", function(event) {
            if (event.key === "Enter") processRequest();
        });

        async function processRequest() {
            const inputId = document.getElementById('input-id').value;
            const inputPwd = document.getElementById('input-pwd').value;
            
            const apiUrl = document.getElementById('api-url').value;
            const httpMethod = document.getElementById('http-method').value;
            const aesKeyStr = document.getElementById('aes-key').value;
            const keyId = document.getElementById('key-id').value;
            const keyPwd = document.getElementById('key-pwd').value;
            const pathString = document.getElementById('res-path').value;

            if (!apiUrl) {
                showToast("âš ï¸ API URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                document.getElementById('api-url').focus();
                return;
            }

            if (aesKeyStr.length !== 32) {
                alert(`ì•”í˜¸í™” í‚¤ëŠ” ë°˜ë“œì‹œ 32ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.\n(í˜„ì¬ ê¸¸ì´: ${aesKeyStr.length}ì)`);
                return;
            }

            let encryptedPwd = "";
            try {
                const key = CryptoJS.enc.Utf8.parse(aesKeyStr);
                const ivStr = aesKeyStr.substring(0, 16);
                const iv = CryptoJS.enc.Utf8.parse(ivStr);

                const encrypted = CryptoJS.AES.encrypt(inputPwd, key, {
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });
                
                encryptedPwd = encrypted.toString();
                console.log(`[ì„¤ì •] Method: ${httpMethod} | URL: ${apiUrl}`);

            } catch (e) {
                alert("ì•”í˜¸í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.message);
                return;
            }

            const requestData = {};
            requestData[keyId] = inputId;
            requestData[keyPwd] = encryptedPwd;

            console.log("ì „ì†¡í•  ë°ì´í„°:", JSON.stringify(requestData, null, 2));

            try {
                // --- [í…ŒìŠ¤íŠ¸ ëª¨ë“œ] ì‹¤ì œ í†µì‹  ëŒ€ì‹  ì„±ê³µ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜ ---
                // ì‹¤ì œ í†µì‹ ì„ ì›í•˜ì‹œë©´ ì•„ë˜ ì£¼ì„ì„ í’€ê³  fetch ë¶€ë¶„ì„ í™œì„±í™”í•˜ì„¸ìš”.
                
                console.log(`[í†µì‹  ì‹œë®¬ë ˆì´ì…˜] ${httpMethod} ë°©ì‹ìœ¼ë¡œ ìš”ì²­ ì „ì†¡ë¨`);
                
                // ê°€ì§œ ì‘ë‹µ ë°ì´í„°
                const jsonResponse = {
                    "body": { "data": { "LEVEL": "1" } }
                };

                /* ì‹¤ì œ í†µì‹  ì½”ë“œ (í•„ìš”ì‹œ ì£¼ì„ í•´ì œ)
                const fetchOptions = {
                    method: httpMethod,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (httpMethod !== 'GET') {
                    fetchOptions.body = JSON.stringify(requestData);
                }
                const response = await fetch(apiUrl, fetchOptions);
                if (!response.ok) throw new Error('Network response was not ok');
                const jsonResponse = await response.json();
                */

                const resultValue = getDeepValue(jsonResponse, pathString);

                if (resultValue !== undefined) {
                    const finalMessage = `ë ˆë²¨ì€ ${resultValue}ì…ë‹ˆë‹¤.`;
                    showResult(finalMessage);
                } else {
                    alert(`ì‘ë‹µ ë°ì´í„°ì—ì„œ ê²½ë¡œ(${pathString})ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì‘ë‹µê°’: ${JSON.stringify(jsonResponse)}`);
                }

            } catch (error) {
                console.error(error);
                alert("í†µì‹  ì˜¤ë¥˜ ë°œìƒ: " + error.message);
            }
        }

        function getDeepValue(obj, path) {
            return path.split('.').reduce((acc, part) => acc && acc[part], obj);
        }

        // --- [3] ê²°ê³¼ í‘œì‹œ ë° ì•ˆì „í•œ ë³µì‚¬ ì˜ì—­ ---

        function showResult(text) {
            const resultArea = document.getElementById('result-area');
            const resultText = document.getElementById('result-text');
            resultText.innerText = text;
            resultArea.style.display = 'block';
            
            // í´ë¦­ ì‹œ ì•ˆì „í•œ ë³µì‚¬ í•¨ìˆ˜ í˜¸ì¶œ
            resultArea.onclick = () => {
                copyToClipboard(text);
            };
        }

        // ì•ˆì „í•œ ë³µì‚¬ í•¨ìˆ˜ (HTTPS, Localhost, File í”„ë¡œí† ì½œ ëª¨ë‘ ì§€ì›)
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                // ìµœì‹  ë¸Œë¼ìš°ì € ë°©ì‹
                navigator.clipboard.writeText(text).then(() => {
                    showToast(`ë³µì‚¬ ì™„ë£Œ: "${text}"`);
                }).catch(err => {
                    fallbackCopy(text);
                });
            } else {
                // êµ¬í˜• ë°©ì‹ (ì˜¤ë¥˜ í•´ê²°)
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast(`ë³µì‚¬ ì™„ë£Œ: "${text}"`);
                } else {
                    alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            } catch (err) {
                alert("ë³µì‚¬ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
            document.body.removeChild(textArea);
        }

        function showToast(message) {
            const toast = document.getElementById("toast");
            if (!toast) return;

            toast.innerText = message;
            toast.className = "show";

            setTimeout(function(){ 
                toast.className = toast.className.replace("show", ""); 
            }, 3000);
        }
    </script>
</body>
</html>