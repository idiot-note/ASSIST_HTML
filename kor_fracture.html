<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹¨ì§„ í•œê¸€ ë³µêµ¬ ë„êµ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3b82f6',
                        'dark-bg': '#1f2937',
                        'card-bg': '#374151',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-track {
            background-color: #1f2937;
        }
    </style>
</head>
<body class="bg-dark-bg min-h-screen p-4 sm:p-8 flex flex-col items-center font-sans text-gray-100">

    <header class="text-center mb-8">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-primary-blue mb-2 flex items-center justify-center">
            <span class="mr-2 text-yellow-400">ğŸ› ï¸</span>
            ê¹¨ì§„ í•œê¸€ (ë˜ ë°©ê°í•˜) ë³µêµ¬ê¸°
        </h1>
        <p class="text-gray-400">
            ISO-8859-1ë¡œ ì˜ëª» ì¸ì½”ë”©ëœ UTF-8 ë¬¸ìì—´ì„ ì›ë˜ëŒ€ë¡œ ë³µì›í•©ë‹ˆë‹¤.
        </p>
    </header>

    <main class="w-full max-w-4xl space-y-6">

        <section class="bg-card-bg p-5 rounded-xl shadow-lg">
            <label for="brokenText" class="block text-xl font-semibold mb-3 text-red-300">
                1. ê¹¨ì§„ í•œê¸€ ì…ë ¥ (ì˜ˆ: Ã«Â©â€Ã¬ÂÂ¼ Ã«Â³Â´Ã«â€šÂ´Ã«Å â€...)
            </label>
            <textarea
                id="brokenText"
                rows="8"
                class="w-full p-4 bg-gray-700 text-lg text-white border border-gray-600 rounded-lg focus:ring-primary-blue focus:border-primary-blue outline-none transition duration-150"
                placeholder="ì—¬ê¸°ì— ê¹¨ì§„ í•œê¸€ ë¬¸ìì—´ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì…ë ¥ ì¦‰ì‹œ ë³µêµ¬ë©ë‹ˆë‹¤."
                oninput="processText()"
            ></textarea>

            <div class="flex flex-wrap gap-4 mt-4 items-center">
                <div class="flex items-center space-x-2">
                    <label for="brokenEncoding" class="text-sm font-medium text-gray-300">ê¹¨ì§„ ì¸ì½”ë”©:</label>
                    <select id="brokenEncoding" onchange="processText()" class="p-2 bg-gray-600 border border-gray-500 rounded text-sm text-white focus:ring-primary-blue focus:border-primary-blue">
                        <option value="ISO-8859-1">ISO-8859-1</option>
                        <option value="EUC-KR">EUC-KR</option>
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <label for="originalEncoding" class="text-sm font-medium text-gray-300">ì›ë³¸ ì¸ì½”ë”©:</label>
                    <select id="originalEncoding" onchange="processText()" class="p-2 bg-gray-600 border border-gray-500 rounded text-sm text-white focus:ring-primary-blue focus:border-primary-blue">
                        <option value="UTF-8">UTF-8</option>
                        <option value="EUC-KR">EUC-KR</option>
                        <option value="MS949">MS949</option>
                    </select>
                </div>
                <button onclick="clearTextareas()" class="flex-shrink-0 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    ëª¨ë‘ ì§€ìš°ê¸°
                </button>
            </div>
        </section>

        <section class="bg-card-bg p-5 rounded-xl shadow-lg relative">
            <label for="fixedText" class="block text-xl font-semibold mb-3 text-green-300">
                2. ì •ìƒ ë³µì›ëœ í•œê¸€ (í´ë¦­í•˜ì—¬ ë³µì‚¬)
            </label>
            
            <div id="fixedTextContainer"
                 class="relative cursor-pointer"
                 onclick="copyToClipboard()">
                
                <textarea
                    id="fixedText"
                    rows="8"
                    readonly
                    class="w-full p-4 bg-gray-700 text-lg text-white border border-gray-600 rounded-lg resize-none pointer-events-none opacity-90"
                    placeholder="ë³µì›ëœ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
                ></textarea>
                
                <div id="copyMessage" 
                     class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-primary-blue text-white py-2 px-4 rounded-full shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none text-sm font-medium">
                    í´ë¦½ë³´ë“œì— ë³µì‚¬ ì™„ë£Œ!
                </div>
            </div>

            <p class="mt-4 text-sm text-gray-400">
                í˜„ì¬ ì˜ˆì‹œ: <span class="font-mono text-red-300">Ã«Â©â€Ã¬ÂÂ¼ Ã«Â³Â´Ã«â€šÂ´Ã«Å â€ Ã¬â€šÂ¬Ã«Å¾Å’ Ã¬ÂÂ´Ã«Â¦â€</span>  $\rightarrow$  <span class="text-green-300">ë©”ì¼ ë³´ë‚´ëŠ” ì‚¬ëŒ ì´ë¦„</span>
            </p>

        </section>
    </main>

    <script>
        // ì „ì—­ ìƒìˆ˜ ì„ ì–¸ (DOMì´ ë¨¼ì € ë¡œë“œë˜ì—ˆìœ¼ë¯€ë¡œ ì•ˆì „í•¨)
        const brokenTextarea = document.getElementById('brokenText');
        const fixedTextarea = document.getElementById('fixedText');
        const copyMessage = document.getElementById('copyMessage');
        const brokenEncodingSelect = document.getElementById('brokenEncoding');
        const originalEncodingSelect = document.getElementById('originalEncoding');

        /**
         * ISO-8859-1ë¡œ ê¹¨ì§„ UTF-8 ë¬¸ìì—´ì„ ì •ìƒì ìœ¼ë¡œ ë³µêµ¬í•©ë‹ˆë‹¤.
         */
        function fixBrokenKorean(brokenString, brokenEnc, originalEnc) {
            if (!brokenString) return "";
            
            try {
                // brokenEncì™€ originalEncëŠ” onchange ì´ë²¤íŠ¸ë¡œ ì¸í•´ í•­ìƒ ì •ì˜ëœ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤.

                // 1. ISO-8859-1ë¡œ ì˜ëª» í•´ì„ëœ UTF-8 ë³µêµ¬ (ê°€ì¥ í”í•œ ë˜ ë°©ê°í•˜ íŒ¨í„´)
                if (brokenEnc === 'ISO-8859-1' && originalEnc === 'UTF-8') {
                    const iso88591Bytes = brokenString.split('').map(c => c.charCodeAt(0));
                    const utf8Bytes = new Uint8Array(iso88591Bytes);
                    const decoder = new TextDecoder('utf-8');
                    return decoder.decode(utf8Bytes);
                }

                // ì°¸ê³ : ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œ TextEncoder/TextDecoderë§Œìœ¼ë¡œëŠ” ë‹¤ë¥¸ ì¸ì½”ë”© ì¡°í•©ì„ ì²˜ë¦¬í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.
                // ì™„ë²½í•œ ë³µêµ¬ë¥¼ ìœ„í•´ì„œëŠ” ì™¸ë¶€ ì¸ì½”ë”© ë¼ì´ë¸ŒëŸ¬ë¦¬(ì˜ˆ: iconv-lite)ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                return "ì§€ì›í•˜ì§€ ì•ŠëŠ” ì¸ì½”ë”© ì¡°í•©ì…ë‹ˆë‹¤. (ISO-8859-1 -> UTF-8 ë§Œ ì§€ì›)";
                
            } catch (error) {
                console.error("ë³µêµ¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                // "ë³µêµ¬ ì‹¤íŒ¨: ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ìì—´ í˜•ì‹ì…ë‹ˆë‹¤."
                return `ë³µêµ¬ ì‹¤íŒ¨: ${error.message}`;
            }
        }

        /**
         * Unicode ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ (\uXXXX)ë¥¼ ì¼ë°˜ ë¬¸ìë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
         * @param {string} unicodeString - Unicode ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìì—´ (ì˜ˆ: '\uB0B4\uC5D0\uC11C')
         * @returns {string} - ë³€í™˜ëœ ë¬¸ìì—´ (ì˜ˆ: 'ë‚´ì—ì„œ')
         */
        function decodeUnicodeEscapes(unicodeString) {
            // \uXXXX íŒ¨í„´ì„ ì°¾ì•„ì„œ ì½œë°± í•¨ìˆ˜ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
            return unicodeString.replace(/\\u([\dA-Fa-f]{4})/g, (match, hex) => {
                // 16ì§„ìˆ˜ ê°’ì„ ì •ìˆ˜ë¡œ ë³€í™˜í•˜ì—¬ í•´ë‹¹ ì½”ë“œ í¬ì¸íŠ¸ì˜ ë¬¸ìë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
                return String.fromCharCode(parseInt(hex, 16));
            });
        }
        
        function processText() {
        const brokenInput = brokenTextarea.value;
        const brokenEnc = brokenEncodingSelect.value;
        const originalEnc = originalEncodingSelect.value;
        
        let fixedOutput = brokenInput;

        // A. Unicode ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ (\uXXXX) í˜•íƒœì¸ì§€ í™•ì¸í•˜ê³  ì²˜ë¦¬
        if (brokenInput.includes('\\u')) {
            fixedOutput = decodeUnicodeEscapes(brokenInput);
        
        // B. ì¼ë°˜ì ì¸ ì¸ì½”ë”© ê¹¨ì§ (ë˜ ë°©ê°í•˜) ì²˜ë¦¬
        } else {
            fixedOutput = fixBrokenKorean(brokenInput, brokenEnc, originalEnc);
        }
        
        fixedTextarea.value = fixedOutput;
        }

        /**
         * í…ìŠ¤íŠ¸ ì§€ìš°ê¸° í•¨ìˆ˜
         */
        function clearTextareas() {
            brokenTextarea.value = '';
            fixedTextarea.value = '';
            processText(); // ì§€ìš°ê³  ë‚˜ë©´ ê²°ê³¼ë„ ë¹„ì›Œì¤ë‹ˆë‹¤.
            brokenTextarea.focus(); // ì…ë ¥ë€ìœ¼ë¡œ í¬ì»¤ìŠ¤ ì´ë™
        }

        /**
         * ë³µì‚¬ ê¸°ëŠ¥ í•¨ìˆ˜
         */
        function copyToClipboard() {
            if (fixedTextarea.value) {
                // execCommand('copy')ëŠ” IFrame í™˜ê²½ì—ì„œ ê°€ì¥ ì•ˆì •ì ì¸ ë³µì‚¬ ë°©ë²•ì…ë‹ˆë‹¤.
                fixedTextarea.select();
                fixedTextarea.setSelectionRange(0, 99999); // ëª¨ë°”ì¼ ì§€ì›
                try {
                    document.execCommand('copy');
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    copyMessage.classList.remove('opacity-0');
                    copyMessage.classList.add('opacity-100');

                    // 1.5ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¹€
                    setTimeout(() => {
                        copyMessage.classList.remove('opacity-100');
                        copyMessage.classList.add('opacity-0');
                    }, 1500);

                } catch (err) {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    alert('ë³µì‚¬ ì‹¤íŒ¨: ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            } else {
                console.log("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
        
        // ì´ˆê¸° ë¡œë“œ ì‹œ ì˜ˆì‹œ í…ìŠ¤íŠ¸ ì„¤ì • ë° ì´ˆê¸° ì²˜ë¦¬
        window.onload = function() {
            // ì‚¬ì¥ë‹˜ê»˜ì„œ ìš”ì²­í•˜ì‹  í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸° ì˜ˆì‹œë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
            const exampleText = '#**** Keystore \uB0B4\uC5D0\uC11C \uC778\uC99D\uC11C\uB97C \uC2DD\uBCC4\uD558\uB294 \uBCC4\uCE6D';
            
            // ì¼ë°˜ì ì¸ ë˜ ë°©ê°í•˜ ì˜ˆì‹œë¥¼ ìœ ì§€í•˜ë ¤ë©´ ì•„ë˜ ì¤„ì„ ì‚¬ìš©í•˜ì„¸ìš”.
            // const exampleText = 'Ã«Â©â€Ã¬ÂÂ¼ Ã«Â³Â´Ã«â€šÂ´Ã«Å â€ Ã¬â€šÂ¬Ã«Å¾Å’ Ã¬ÂÂ´Ã«Â¦â€ :: applicationPropertiesÃ¬â€”ÂÃ¬â€Å“ ÃªÂ´â‚¬Ã«Â¦Â¬Ã­â€¢ËœÃ«Â¯â‚¬Ã«Â¡Å“ Ã­â€¢Å“ÃªÂ¸â‚¬ Ã«Â³â‚¬Ã¬Ë†Â Ã«Å â€ Ã¬â€”Â¬ÃªÂ¸Â°Ã¬â€Å“ Ã¬Â²ËœÃ«Â¦Â¬';
            
            brokenTextarea.value = exampleText;
            processText(); // ì¦‰ì‹œ ì²˜ë¦¬
        };

    </script>
</body>
</html>